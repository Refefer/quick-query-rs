# Example agents.toml configuration file
# Copy to ~/.config/qq/agents.toml to customize agent behavior
#
# Built-in agents: chat, researcher, summarizer, coder, reviewer, explore, planner, writer
#
# Configuration options:
#   max_turns        - Maximum agentic loop turns (safety ceiling)
#   tool_limits      - Per-tool call limits (tool_name -> max_calls)
#   memory_strategy  - "obs-memory" or "compaction" (see below)
#   max_observations - Max observation passes before wrap-up (obs-memory only)
#   compact_prompt   - Custom summarization prompt (compaction only)
#
# Memory strategies:
#   obs-memory   - In-loop observational memory (default for built-in agents).
#                  Older messages are distilled into an observation log during execution.
#                  Allows very long runs. max_turns is raised to 500 automatically.
#                  Use max_observations to control when the agent wraps up.
#   compaction   - Post-execution LLM summarization (default for external agents).
#                  Agent runs up to max_turns, then summarizes and restarts (up to 3x).
#                  Use compact_prompt to customize what gets preserved.
#
# When a tool limit is reached, the agent receives an error prompting it to complete.
#
# NOTE: All agents automatically have access to `inform_user` - a tool that sends
# status messages to the user without ending the agent's turn. Use it to keep
# users informed during long-running tasks (e.g., "Searching codebase...",
# "Delegating to researcher..."). No configuration needed.

# ============================================================================
# BUILT-IN AGENT OVERRIDES
# ============================================================================
# Use [builtin.<agent_name>] sections to override settings for internal agents.
# These take precedence over the hardcoded defaults.

[builtin.researcher]
# Default tools: web_search, fetch_webpage, read_preference + inform_user
# memory_strategy = "obs-memory"  # default for all built-in agents
max_turns = 10
tool_limits = { web_search = 2, fetch_webpage = 5 }

[builtin.coder]
# Default tools: read_file, edit_file, write_file, find_files, search_files + inform_user
# memory_strategy = "obs-memory"  # default - context managed in-loop
max_observations = 15             # wrap up after 15 observation passes
# max_turns is auto-raised to 500 with obs-memory; override here if needed

[builtin.explore]
# Default tools: read_file, find_files, search_files + inform_user
# memory_strategy = "obs-memory"  # default
max_observations = 12

[builtin.reviewer]
# Default tools: read_file, find_files, search_files + inform_user
# memory_strategy = "obs-memory"  # default
# max_observations = 10           # default

[builtin.writer]
# Default tools: read_file, write_file, find_files, search_files + inform_user
# memory_strategy = "obs-memory"  # default
max_observations = 8

[builtin.chat]
# Default tools: Agent tools only + inform_user (delegates all work to other agents)
# memory_strategy = "obs-memory"  # default

[builtin.planner]
# Default tools: read_preference + inform_user (delegates exploration to other agents)
# memory_strategy = "obs-memory"  # default
max_turns = 30

[builtin.summarizer]
# Default tools: inform_user only (pure LLM otherwise)
# memory_strategy = "obs-memory"  # default
max_turns = 20

# Example: switch an agent back to the old compaction strategy
# [builtin.coder]
# memory_strategy = "compaction"
# max_turns = 100
# compact_prompt = "Summarize the coding session preserving file paths and changes made."

# ============================================================================
# EXTERNAL AGENT DEFINITIONS
# ============================================================================

# Custom research agent using compaction (default for external agents)
# Note: inform_user is automatically available to all agents
[agents.doc-researcher]
description = "Research technical documentation and APIs"
# memory_strategy = "compaction"  # default for external agents
system_prompt = """
You are a technical documentation researcher. Your task is to find and
analyze technical documentation, API references, and developer guides.

Guidelines:
- Use inform_user to keep the user updated on your progress
- Focus on official documentation sources
- Extract code examples when relevant
- Summarize key concepts and patterns
- Note version-specific information
- Highlight common pitfalls or gotchas
"""
max_turns = 8
tools = ["fetch_webpage", "web_search"]
tool_limits = { web_search = 3, fetch_webpage = 5 }
# Custom compaction prompt - preserves documentation-specific context when memory is summarized
# (only used with memory_strategy = "compaction")
compact_prompt = """
Summarize this documentation research session. Preserve:
1. API endpoints, function signatures, and code examples found
2. Source URLs for each piece of documentation referenced
3. Version-specific information and compatibility notes
4. Common pitfalls or gotchas discovered
5. Areas not yet researched or needing follow-up
"""

# Code explanation agent
# Note: inform_user is automatically available even to pure LLM agents
[agents.explainer]
description = "Explain code in detail"
system_prompt = """
You are a code explanation expert. When given code, you provide clear,
detailed explanations of what the code does.

For each piece of code:
1. Provide a high-level summary
2. Explain each significant section
3. Highlight any patterns or idioms used
4. Note any potential issues or improvements
5. Explain any complex logic step by step

Use simple language and analogies when helpful.
Use inform_user for progress updates on long explanations.
"""
max_turns = 1
tools = []  # Pure LLM agent - inform_user is still available

# Git helper agent using obs-memory for thorough repo exploration
# Note: inform_user is automatically available to all agents
[agents.git-helper]
description = "Help with git operations and history"
memory_strategy = "obs-memory"  # in-loop context management
max_observations = 8
system_prompt = """
You are a git expert assistant. Help users understand their git repository
by exploring files and providing guidance.

You can:
- Analyze code to suggest commit messages
- Explain code changes
- Help plan branch strategies
- Create or update .gitignore files

Use inform_user to keep the user updated on your progress.
Be concise and practical in your advice.
"""
tools = ["read_file", "write_file", "find_files", "search_files"]
tool_limits = { read_file = 15, write_file = 5, find_files = 10, search_files = 10 }

# Security reviewer agent using obs-memory for deep analysis
# Note: inform_user is automatically available to all agents
[agents.security-reviewer]
description = "Review code for security issues"
memory_strategy = "obs-memory"  # in-loop observational memory for deep analysis
max_observations = 10
system_prompt = """
You are a security-focused code reviewer. Analyze code for potential
security vulnerabilities and provide actionable recommendations.

Use inform_user to keep the user updated on your progress (e.g., "Analyzing
authentication module...", "Checking for injection vulnerabilities...").

Focus areas:
- Input validation and sanitization
- Authentication and authorization
- Data exposure risks
- Injection vulnerabilities (SQL, command, etc.)
- Cryptographic issues
- Configuration security

For each issue found:
1. Describe the vulnerability
2. Explain the potential impact
3. Provide a specific fix recommendation
4. Rate severity (Critical/High/Medium/Low)
"""
tools = ["read_file", "find_files", "search_files"]
tool_limits = { read_file = 20, find_files = 10, search_files = 10 }
